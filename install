
#!/bin/bash

DOTFILES="${HOME}/.dotfiles"            # Base it on `pwd'!
DOTHOME=${DOTFILES}/home

# Make a backup directory for overwritten dotfiles.
if [[ ! -e ${DOTFILES}/backup ]]; then
    mkdir ${DOTFILES}/backup
fi

function symlinkifne {
    echo -n "$1..."
    if [[ -e $1 ]]; then
        # File exists.
        if [[ -L $1 ]]; then
            # It's already a simlink (could have come from this project).
            echo ' symlink already exists... skipping!'
            return
        fi
        # Backup file does not exist yet.
        if [[ ! -e ${DOTFILES}/backup/$1 ]]; then
            mv $1 ${DOTFILES}/backup/
            echo -n ' backing up target;'
        fi
    fi
    # Create the link.
    ln -s ${DOTHOME}/$1 $1
    echo ' symlinking... done'
}

cd ${HOME}

for config_file in $(ls --almost-all ${DOTHOME})
do
    config_file=$(basename $config_file)
    symlinkifne $config_file
done
